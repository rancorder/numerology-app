import streamlit as st
import pyperclip
import re

# ãƒ©ã‚¤ãƒ•ãƒ‘ã‚¹ãƒŠãƒ³ãƒãƒ¼ã®æ„å‘³ã‚’è¾æ›¸ã§ç®¡ç†
numerology_meanings = {
    1: "ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã«å„ªã‚Œã€è‡ªç«‹å¿ƒãŒå¼·ã„ã€‚",
    2: "å”èª¿æ€§ãŒã‚ã‚Šã€å¹³å’Œã‚’æ„›ã™ã‚‹ã€‚",
    3: "å‰µé€ çš„ã§ã€è¡¨ç¾åŠ›ãŒè±Šã‹ã€‚",
    4: "åŠªåŠ›å®¶ã§ã€å®‰å®šã‚’å¥½ã‚€ã€‚",
    5: "è‡ªç”±ã‚’æ„›ã—ã€å†’é™ºå¿ƒãŒå¼·ã„ã€‚",
    6: "è²¬ä»»æ„ŸãŒå¼·ãã€å®¶åº­çš„ã€‚",
    7: "çŸ¥çš„ã§ã€åˆ†æåŠ›ã«å„ªã‚Œã‚‹ã€‚",
    8: "é‡å¿ƒçš„ã§ã€æˆåŠŸã‚’æ±‚ã‚ã‚‹ã€‚",
    9: "åšæ„›ä¸»ç¾©è€…ã§ã€ç²¾ç¥çš„ã«æˆç†Ÿã—ã¦ã„ã‚‹ã€‚",
    11: "ç›´æ„ŸãŒé‹­ãã€ã‚«ãƒªã‚¹ãƒæ€§ãŒã‚ã‚‹ï¼ˆãƒã‚¹ã‚¿ãƒ¼ãƒŠãƒ³ãƒãƒ¼ï¼‰ã€‚",
    22: "ç¾å®Ÿçš„ãªå¤¢ã‚’å®Ÿç¾ã§ãã‚‹å¼·ã„åŠ›ã‚’æŒã¤ï¼ˆãƒã‚¹ã‚¿ãƒ¼ãƒŠãƒ³ãƒãƒ¼ï¼‰ã€‚",
    33: "å¥‰ä»•ã®ç²¾ç¥ã‚’æŒã¡ã€ã‚«ãƒªã‚¹ãƒæ€§ã«ã‚ãµã‚Œã‚‹ï¼ˆãƒã‚¹ã‚¿ãƒ¼ãƒŠãƒ³ãƒãƒ¼ï¼‰ã€‚",
}

# ç›¸æ€§è¨ºæ–­ã‚¹ã‚³ã‚¢
def calculate_compatibility_score(num1, num2):
    compatibility_matrix = {
        (1, 2): (85, "ãƒªãƒ¼ãƒ€ãƒ¼(1)ã¨ã‚µãƒãƒ¼ã‚¿ãƒ¼(2)ã®ç›¸æ€§ã¯æŠœç¾¤ï¼"),
        (3, 5): (90, "è‡ªç”±ã‚’æ„›ã™ã‚‹äºŒäººã€æ¥½ã—ã„é–¢ä¿‚ã«ãªã‚Šãã†ï¼"),
        (4, 8): (75, "å®‰å®šå¿—å‘(4)ã¨æˆåŠŸå¿—å‘(8)ã€ä»•äº‹ãªã‚‰æœ€å¼·ã‚³ãƒ³ãƒ“ã€‚"),
        (7, 9): (80, "çŸ¥æ€§(7)ã¨ç²¾ç¥æ€§(9)ãŒæ·±ã„ç†è§£ã‚’ç”Ÿã‚€é–¢ä¿‚ã€‚"),
    }
    key = tuple(sorted((num1, num2)))
    return compatibility_matrix.get(key, (50, "æ™®é€šã®ç›¸æ€§ã§ã™ã€‚ãŠäº’ã„ã‚’å°Šé‡ã—ã¾ã—ã‚‡ã†ã€‚"))

# ãƒ©ã‚¤ãƒ•ãƒ‘ã‚¹ãƒŠãƒ³ãƒãƒ¼ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
def calculate_life_path_number(birthdate):
    digits = [int(d) for d in re.sub(r"\D", "", birthdate)]  # æ•°å­—ã®ã¿æŠ½å‡º
    total = sum(digits)
    while total > 9 and total not in (11, 22, 33):
        total = sum(map(int, str(total)))  # å„æ¡ã‚’å†åº¦è¶³ã™
    return total

# Streamlit UI
st.title("ğŸ”® æ•°ç§˜è¡“å ã„ & ç›¸æ€§è¨ºæ–­ ğŸ”®")
st.write("èª•ç”Ÿæ—¥ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ãƒ©ã‚¤ãƒ•ãƒ‘ã‚¹ãƒŠãƒ³ãƒãƒ¼ã¨å ã„çµæœã‚’ãŠä¼ãˆã—ã¾ã™ï¼")

# èª•ç”Ÿæ—¥å…¥åŠ›
birthdate = st.text_input("ã‚ãªãŸã®èª•ç”Ÿæ—¥ã‚’å…¥åŠ›ï¼ˆä¾‹: 20250215, 2015/02/15ï¼‰:", "")

if birthdate:
    try:
        life_path_number = calculate_life_path_number(birthdate)
        st.subheader(f"ã‚ãªãŸã®ãƒ©ã‚¤ãƒ•ãƒ‘ã‚¹ãƒŠãƒ³ãƒãƒ¼ã¯ã€{life_path_number}ã€‘ã§ã™ï¼")
        st.write(f"**{numerology_meanings.get(life_path_number, 'ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“')}**")
        
        # Xï¼ˆæ—§Twitterï¼‰æŠ•ç¨¿ç”¨ãƒ†ã‚­ã‚¹ãƒˆ
        tweet_text = f"ç§ã®ãƒ©ã‚¤ãƒ•ãƒ‘ã‚¹ãƒŠãƒ³ãƒãƒ¼ã¯ã€{life_path_number}ã€‘ğŸ‰ {numerology_meanings.get(life_path_number, '')} #æ•°ç§˜è¡“ #å ã„"
        st.text_area("ğŸ“Œ Xã«æŠ•ç¨¿ã™ã‚‹ã«ã¯ã€ã“ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„:", tweet_text, height=100)

        if st.button("ğŸ“‹ ã‚³ãƒ”ãƒ¼ã™ã‚‹"):
            pyperclip.copy(tweet_text)
            st.success("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼Xã«è²¼ã‚Šä»˜ã‘ã¦æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚")

    except ValueError:
        st.error("âš ï¸ æ­£ã—ã„èª•ç”Ÿæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: 20250215, 2015/02/15ï¼‰")

# ç›¸æ€§è¨ºæ–­
st.subheader("â¤ï¸ æ°—ã«ãªã‚‹äººã¨ã®ç›¸æ€§è¨ºæ–­ â¤ï¸")
partner_birthdate = st.text_input("ç›¸æ‰‹ã®èª•ç”Ÿæ—¥ã‚’å…¥åŠ›ï¼ˆä¾‹: 20250215, 2015/02/15ï¼‰:", "")
relationship_type = st.selectbox("é–¢ä¿‚æ€§ã‚’é¸æŠ:", ["æ‹äºº", "åŒæ€§ã®å‹é”", "ç•°æ€§ã®å‹é”", "åŒåƒš"])

if partner_birthdate:
    try:
        partner_life_path = calculate_life_path_number(partner_birthdate)
        st.write(f"ç›¸æ‰‹ã®ãƒ©ã‚¤ãƒ•ãƒ‘ã‚¹ãƒŠãƒ³ãƒãƒ¼ã¯ã€{partner_life_path}ã€‘ã§ã™ï¼")

        # ç›¸æ€§ã‚¹ã‚³ã‚¢ã¨ã‚³ãƒ¡ãƒ³ãƒˆ
        score, compatibility_comment = calculate_compatibility_score(life_path_number, partner_life_path)
        
        st.subheader(f"âœ¨ {relationship_type}ã®ç›¸æ€§è¨ºæ–­ âœ¨")
        st.write(f"â¤ï¸ **ç›¸æ€§ã‚¹ã‚³ã‚¢: {score}/100**")
        st.write(f"ğŸ“ **{compatibility_comment}**")

        # é–¢ä¿‚æ€§ã”ã¨ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹
        if relationship_type == "æ‹äºº":
            st.write("ğŸ’– **æ‹æ„›ã‚¢ãƒ‰ãƒã‚¤ã‚¹:** ãŠäº’ã„ã®ä¾¡å€¤è¦³ã‚’å°Šé‡ã—åˆã†ã“ã¨ã§é–¢ä¿‚ãŒæ·±ã¾ã‚Šã¾ã™ï¼")
        elif relationship_type == "åŒæ€§ã®å‹é”":
            st.write("ğŸ˜Š **å‹æƒ…ã‚¢ãƒ‰ãƒã‚¤ã‚¹:** ç„¡ç†ã›ãšè‡ªç„¶ä½“ã§æ¥ã™ã‚‹ã¨ã€é•·ç¶šãã™ã‚‹å‹æƒ…ã«ï¼")
        elif relationship_type == "ç•°æ€§ã®å‹é”":
            st.write("ğŸ­ **ç•°æ€§ã®å‹é”:** æ‹æ„›æ„Ÿæƒ…ã‚’æŒãŸãšã€ç´ ç›´ã«è©±ã›ã‚‹é–¢ä¿‚ãŒâ—")
        elif relationship_type == "åŒåƒš":
            st.write("ğŸ’¼ **è·å ´ã‚¢ãƒ‰ãƒã‚¤ã‚¹:** å½¹å‰²åˆ†æ‹…ã‚’æ„è­˜ã™ã‚‹ã¨ã€ãŠäº’ã„ã®å¼·ã¿ã‚’æ´»ã‹ã›ã¾ã™ï¼")

    except ValueError:
        st.error("âš ï¸ æ­£ã—ã„èª•ç”Ÿæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: 20250215, 2015/02/15ï¼‰")

# ãƒ•ãƒƒã‚¿ãƒ¼
st.write("ğŸ“… ãƒ©ã‚¤ãƒ•ãƒ‘ã‚¹ãƒŠãƒ³ãƒãƒ¼ã¯ã€èª•ç”Ÿæ—¥ã®æ•°å­—ã‚’ã™ã¹ã¦è¶³ã—ã¦è¨ˆç®—ã—ã¾ã™ã€‚11, 22, 33ã¯ç‰¹åˆ¥ãªãƒã‚¹ã‚¿ãƒ¼ãƒŠãƒ³ãƒãƒ¼ã§ã™ã€‚")
